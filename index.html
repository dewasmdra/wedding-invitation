<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>Undangan Pernikahan</title>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        width: 100vw;
        height: 100vh;
        overflow: hidden !important;
        background: #000;
        touch-action: none;
        overscroll-behavior: none;
        -webkit-overflow-scrolling: auto;
        scrollbar-width: none;
        /* Tambahkan ini untuk mencegah resize saat keyboard muncul */
        position: fixed;
      }

      /* Tambahkan CSS khusus untuk input agar tidak terpengaruh keyboard */
      .input-container {
        position: fixed !important;
        z-index: 10;
      }

      /* CSS untuk mencegah viewport resize */
      @supports (-webkit-touch-callout: none) {
        .frame-section {
          height: 100vh !important;
          height: -webkit-fill-available !important;
        }

        /* Khusus untuk iOS Safari */
        body {
          position: fixed !important;
          width: 100% !important;
          height: 100% !important;
        }
      }

      /* Mencegah keyboard menggeser layout */
      @media screen and (max-height: 500px) {
        html,
        body {
          height: 100vh !important;
          overflow: hidden !important;
        }
      }

      body::-webkit-scrollbar,
      html::-webkit-scrollbar {
        display: none;
      }
      video {
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        background: #000;
        display: block;
        /* Tambahan untuk iOS */
        height: -webkit-fill-available;
      }
      @media (min-width: 600px) {
        body::before {
          content: "Mohon buka undangan ini di perangkat mobile.";
          color: #fff;
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: #000c;
          z-index: 9999;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 2em;
          text-align: center;
        }
        main#invitation-sections {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <!-- Audio element untuk musik background -->
    <audio id="background-music" loop preload="auto">
      <source src="wedding-music.mp3" type="audio/mpeg" />
      <source src="wedding-music.ogg" type="audio/ogg" />
    </audio>

    <!-- Tombol kontrol musik -->
    <div
      id="music-control"
      style="
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
      "
      onclick="toggleBackgroundMusic()"
    >
      <span
        id="music-icon"
        style="color: white; font-size: 20px; user-select: none"
        >🔊</span
      >
    </div>

    <main id="invitation-sections">
      <section class="frame-section" id="frame-1">
        <video
          src="frame.mp4"
          id="video1"
          playsinline
          autoplay
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
      <section class="frame-section" id="frame-2" style="display: none">
        <video
          src="frame2.mp4"
          id="video2"
          playsinline
          webkit-playsinline
          preload="auto"
          loop
        ></video>
      </section>
      <section class="frame-section" id="frame-3" style="display: none">
        <video
          src="frame3.mp4"
          id="video3"
          playsinline
          webkit-playsinline
          preload="auto"
          loop
        ></video>
      </section>
      <section
        class="frame-section"
        id="frame-4"
        style="display: none; position: relative"
      >
        <video
          src="frame4.mp4"
          id="video4"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
        <div
          id="countdown"
          style="
            position: absolute;
            z-index: 2;
            bottom: 15%;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 320px;
            text-align: center;
            color: #fff;
            font-size: 1.8em;
            font-family: sans-serif;
            text-shadow: 0 2px 8px #000;
            letter-spacing: 1px;
            display: flex;
            justify-content: center;
            gap: 0.4em;
            flex-wrap: wrap;
          "
        >
          <div
            style="
              display: flex;
              flex-direction: column;
              align-items: center;
              background: #6e2629;
              border-radius: 8px;
              padding: 10px 8px;
              box-shadow: 0 3px 15px rgba(0, 0, 0, 0.3);
              min-width: 45px;
            "
          >
            <span id="days" style="font-size: 1em; font-weight: bold">00</span>
            <span style="font-size: 0.35em; margin-top: -0.1em">HARI</span>
          </div>
          <div
            style="
              display: flex;
              flex-direction: column;
              align-items: center;
              background: #6e2629;
              border-radius: 8px;
              padding: 10px 8px;
              box-shadow: 0 3px 15px rgba(0, 0, 0, 0.3);
              min-width: 45px;
            "
          >
            <span id="hours" style="font-size: 1em; font-weight: bold">00</span>
            <span style="font-size: 0.35em; margin-top: -0.1em">JAM</span>
          </div>
          <div
            style="
              display: flex;
              flex-direction: column;
              align-items: center;
              background: #6e2629;
              border-radius: 8px;
              padding: 10px 8px;
              box-shadow: 0 3px 15px rgba(0, 0, 0, 0.3);
              min-width: 45px;
            "
          >
            <span id="minutes" style="font-size: 1em; font-weight: bold"
              >00</span
            >
            <span style="font-size: 0.35em; margin-top: -0.1em">MENIT</span>
          </div>
          <div
            style="
              display: flex;
              flex-direction: column;
              align-items: center;
              background: #6e2629;
              border-radius: 8px;
              padding: 10px 8px;
              box-shadow: 0 3px 15px rgba(0, 0, 0, 0.3);
              min-width: 45px;
            "
          >
            <span id="seconds" style="font-size: 1em; font-weight: bold"
              >00</span
            >
            <span style="font-size: 0.35em; margin-top: -0.1em">DETIK</span>
          </div>
        </div>

        <!-- Button Save to Calendar -->
        <div
          style="
            position: absolute;
            bottom: 5%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3;
          "
        >
          <button
            onclick="saveToCalendar()"
            style="
              background: #6e2629;
              color: #fff0b4;
              border: 2px solid rgba(255, 255, 255, 0.8);
              border-radius: 25px;
              padding: 12px 20px;
              font-size: 12px;
              font-family: sans-serif;
              font-weight: bold;
              cursor: pointer;
              box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
              transition: all 0.3s ease;
              outline: none;
              backdrop-filter: blur(10px);
            "
            onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 20px rgba(0, 0, 0, 0.4)'"
            onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 15px rgba(0, 0, 0, 0.3)'"
            ontouchstart="this.style.transform='scale(0.95)'"
            ontouchend="this.style.transform='scale(1)'"
          >
            📅 Save to Calendar
          </button>
        </div>
      </section>
      <section class="frame-section" id="frame-5" style="display: none">
        <video
          src="frame5.mp4"
          id="video5"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
      <section class="frame-section" id="frame-6" style="display: none">
        <video
          src="frame6.mp4"
          id="video6"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
      <section class="frame-section" id="frame-7" style="display: none">
        <video
          src="frame7.mp4"
          id="video7"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
      <section
        class="frame-section"
        id="frame-8"
        style="display: none; position: relative"
      >
        <video
          src="frame8.mp4"
          id="video8"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
        <a
          href="https://maps.app.goo.gl/EYmAUsSa9VuHvsRW9"
          target="_blank"
          style="
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50%;
            height: 35%;
            z-index: 2;
            display: block;
          "
        ></a>
      </section>
      <section
        class="frame-section"
        id="frame-9"
        style="display: none; position: relative"
      >
        <video
          src="frame9.mp4"
          id="video9"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
        <a
          href="https://maps.app.goo.gl/EYmAUsSa9VuHvsRW9"
          target="_blank"
          style="
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50%;
            height: 35%;
            z-index: 2;
            display: block;
          "
        ></a>
      </section>
      <section class="frame-section" id="frame-10" style="display: none">
        <video
          src="frame10.mp4"
          id="video10"
          playsinline
          webkit-playsinline
          loop
          preload="auto"
        ></video>
      </section>
      <section class="frame-section" id="frame-11" style="display: none">
        <video
          src="frame11.mp4"
          id="video11"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
      <section class="frame-section" id="frame-12" style="display: none">
        <video
          src="frame12.mp4"
          id="video12"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
      <section class="frame-section" id="frame-13" style="display: none">
        <video
          src="frame13.mp4"
          id="video13"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
      <section class="frame-section" id="frame-14" style="display: none">
        <video
          src="frame14.mp4"
          id="video14"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
      <section
        class="frame-section"
        id="frame-14a"
        style="display: none; position: relative"
      >
        <video
          src="frame14-test.mp4"
          id="video14a"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
        <!-- Video overlay di tengah -->
        <video
          id="overlay-video-14a"
          src="ads.mp4"
          style="
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 300px;
            height: auto;
            z-index: 3;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);
            pointer-events: none;
          "
          autoplay
          loop
          muted
          playsinline
          webkit-playsinline
          preload="auto"
          disablePictureInPicture
          controlslist="nodownload nofullscreen noremoteplayback"
        ></video>
      </section>
      <section class="frame-section" id="frame-15" style="display: none">
        <video
          src="frame15.mp4"
          id="video15"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
      <section
        class="frame-section"
        id="frame-16"
        style="display: none; position: relative"
      >
        <video
          src="frame16.mp4"
          id="video16"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
        <input
          type="text"
          id="frame16-input"
          placeholder="Tulis nama Anda..."
          style="
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 200px;
            padding: 5px 15px;
            border: 2px solid rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 16px;
            font-family: sans-serif;
            outline: none;
            z-index: 10;
          "
        />
        <input
          type="text"
          id="frame16-input-2"
          placeholder="Tulis harapan Anda..."
          style="
            position: fixed;
            top: 150px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 200px;
            padding: 5px 15px;
            border: 2px solid rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 16px;
            font-family: sans-serif;
            outline: none;
            z-index: 10;
          "
        />
        <div
          style="
            position: fixed;
            top: 200px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 200px;
            text-align: center;
            z-index: 10;
          "
        >
          <p
            style="
              color: #9a2828;
              font-size: 14px;
              font-family: sans-serif;
              margin: 0 0 10px 0;
              text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
            "
          >
            Konfirmasi
          </p>
          <div
            style="
              display: flex;
              justify-content: start;
              gap: 5px;
              flex-wrap: wrap;
              flex-direction: column;
              align-items: start;
            "
          >
            <label
              style="
                display: flex;
                align-items: center;
                color: #9a2828;
                font-size: 8px;
                font-family: sans-serif;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
                cursor: pointer;
                margin-bottom: 5px;
              "
            >
              <input
                type="radio"
                name="kehadiran"
                value="hadir, 1 orang"
                style="margin-right: 5px; transform: scale(1.2)"
              />
              Hadir (1 orang)
            </label>
            <label
              style="
                display: flex;
                align-items: center;
                color: #9a2828;
                font-size: 8px;
                font-family: sans-serif;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
                cursor: pointer;
                margin-bottom: 5px;
              "
            >
              <input
                type="radio"
                name="kehadiran"
                value="hadir, lebih dari 1 orang"
                style="margin-right: 5px; transform: scale(1.2)"
              />
              Hadir (lebih dari 1 orang)
            </label>
            <label
              style="
                display: flex;
                align-items: center;
                color: #9a2828;
                font-size: 8px;
                font-family: sans-serif;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
                cursor: pointer;
              "
            >
              <input
                type="radio"
                name="kehadiran"
                value="tidak hadir"
                style="margin-right: 5px; transform: scale(1.2)"
              />
              Tidak Hadir
            </label>
          </div>
        </div>

        <!-- Button untuk mengirim data -->
        <div
          style="
            position: fixed;
            top: 500px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 200px;
            text-align: center;
            z-index: 10;
          "
        >
          <button
            id="submit-btn"
            onclick="submitData()"
            style="
              background: linear-gradient(135deg, #9a2828, #c53030);
              color: white;
              border: none;
              border-radius: 25px;
              padding: 12px 25px;
              font-size: 14px;
              font-family: sans-serif;
              font-weight: bold;
              cursor: pointer;
              box-shadow: 0 4px 15px rgba(154, 40, 40, 0.3);
              transition: all 0.3s ease;
              width: 100%;
              max-width: 150px;
              outline: none;
            "
            onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 20px rgba(154, 40, 40, 0.4)'"
            onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 15px rgba(154, 40, 40, 0.3)'"
            ontouchstart="this.style.transform='scale(0.95)'"
            ontouchend="this.style.transform='scale(1)'"
          >
            Kirim Harapan
          </button>
        </div>

        <!-- Counter dan daftar harapan -->
        <div
          style="
            position: fixed;
            top: 340px;
            left: 50%;
            transform: translateX(-50%);
            width: 75%;
            max-width: 250px;
            text-align: center;
            z-index: 10;
          "
        >
          <p
            id="hopes-counter"
            style="
              color: #9a2828;
              font-size: 12px;
              font-family: sans-serif;
              margin: 0 0 15px 0;
              text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
            "
          >
            Total Harapan: <span id="counter-number">0</span>
          </p>

          <div
            id="hopes-list"
            style="
              max-height: 150px;
              overflow-y: auto;
              border-radius: 8px;
              padding: 6px;
              text-align: left;
            "
          >
            <p
              style="
                color: #9a2828;
                font-size: 10px;
                font-family: sans-serif;
                text-align: center;
                margin: 0;
                font-style: italic;
              "
            >
              Belum ada harapan yang ditulis
            </p>
          </div>
        </div>
      </section>
      <section class="frame-section" id="frame-17" style="display: none">
        <video
          src="frame17.mp4"
          id="video17"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
      <section class="frame-section" id="frame-18" style="display: none">
        <video
          src="frame18.mp4"
          id="video18"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
    </main>
    <style>
      .frame-section {
        width: 100vw;
        height: 100vh;
        height: calc(var(--vh, 1vh) * 100);
        display: flex;
        align-items: center;
        justify-content: center;
        background: #000;
        position: fixed;
        top: 0;
        left: 0;
      }
      .frame-section video {
        width: 100vw;
        height: 100vh;
        height: calc(var(--vh, 1vh) * 100);
        object-fit: cover;
      }
    </style>
    <script>
      // Navigasi antar section/frame
      const sections = [
        document.getElementById("frame-1"),
        document.getElementById("frame-2"),
        document.getElementById("frame-3"),
        document.getElementById("frame-4"),
        document.getElementById("frame-5"),
        document.getElementById("frame-6"),
        document.getElementById("frame-7"),
        document.getElementById("frame-8"),
        document.getElementById("frame-9"),
        document.getElementById("frame-10"),
        document.getElementById("frame-11"),
        document.getElementById("frame-12"),
        document.getElementById("frame-13"),
        document.getElementById("frame-14"),
        document.getElementById("frame-14a"),
        document.getElementById("frame-15"),
        document.getElementById("frame-16"),
        document.getElementById("frame-17"),
        document.getElementById("frame-18"),
      ];
      const videos = [
        document.getElementById("video1"),
        document.getElementById("video2"),
        document.getElementById("video3"),
        document.getElementById("video4"),
        document.getElementById("video5"),
        document.getElementById("video6"),
        document.getElementById("video7"),
        document.getElementById("video8"),
        document.getElementById("video9"),
        document.getElementById("video10"),
        document.getElementById("video11"),
        document.getElementById("video12"),
        document.getElementById("video13"),
        document.getElementById("video14"),
        document.getElementById("video14a"),
        document.getElementById("video15"),
        document.getElementById("video16"),
        document.getElementById("video17"),
        document.getElementById("video18"),
      ];
      let currentSection = 0;

      // Frame 1: tunggu klik pada video
      const backgroundMusic = document.getElementById("background-music");

      videos[0].addEventListener("play", () => {
        videos[0].addEventListener(
          "click",
          () => {
            // Mulai memutar musik background
            backgroundMusic
              .play()
              .then(() => {
                updateMusicIcon();
              })
              .catch((error) => {
                console.log("Auto-play music blocked by browser:", error);
              });
            goToSection(1);
          },
          { once: true }
        );
      });

      // Fungsi scroll/swipe untuk frame2 (hanya bisa lanjut ke frame3)
      function enableScrollToContinueForward(targetSection) {
        let startY = null;
        function onTouchStart(e) {
          startY = e.touches ? e.touches[0].clientY : e.clientY;
        }
        function onTouchEnd(e) {
          let endY = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
          if (startY !== null && startY - endY > 50) {
            removeScrollListeners();
            goToSection(targetSection);
          }
        }
        function onWheel(e) {
          if (e.deltaY > 30) {
            removeScrollListeners();
            goToSection(targetSection);
          }
        }
        function removeScrollListeners() {
          window.removeEventListener("touchstart", onTouchStart);
          window.removeEventListener("touchend", onTouchEnd);
          window.removeEventListener("wheel", onWheel);
        }
        window.addEventListener("touchstart", onTouchStart);
        window.addEventListener("touchend", onTouchEnd);
        window.addEventListener("wheel", onWheel);
      }

      // Fungsi scroll/swipe untuk frame3 sampai frame18 (bisa maju/mundur)
      function enableScrollToNavigate(idx) {
        let startY = null;
        function onTouchStart(e) {
          startY = e.touches ? e.touches[0].clientY : e.clientY;
        }
        function onTouchEnd(e) {
          let endY = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
          if (startY !== null && Math.abs(endY - startY) > 50) {
            removeScrollListeners();
            if (startY > endY && idx < sections.length - 1) {
              goToSection(idx + 1); // scroll down
            } else if (startY < endY && idx > 1) {
              goToSection(idx - 1); // scroll up (tidak bisa ke frame1)
            }
          }
        }
        function onWheel(e) {
          if (e.deltaY > 30 && idx < sections.length - 1) {
            removeScrollListeners();
            goToSection(idx + 1);
          } else if (e.deltaY < -30 && idx > 1) {
            removeScrollListeners();
            goToSection(idx - 1);
          }
        }
        function removeScrollListeners() {
          window.removeEventListener("touchstart", onTouchStart);
          window.removeEventListener("touchend", onTouchEnd);
          window.removeEventListener("wheel", onWheel);
        }
        window.addEventListener("touchstart", onTouchStart);
        window.addEventListener("touchend", onTouchEnd);
        window.addEventListener("wheel", onWheel);
      }

      function goToSection(idx) {
        if (idx < 0 || idx >= sections.length) return;
        sections[currentSection].style.display = "none";
        videos[currentSection].pause();

        // Stop overlay video if leaving frame-14a
        if (currentSection === 14) {
          // frame-14a index
          const overlayVideo = document.getElementById("overlay-video-14a");
          if (overlayVideo) {
            overlayVideo.pause();
          }
        }

        currentSection = idx;
        sections[currentSection].style.display = "flex";
        videos[currentSection].currentTime = 0;
        videos[currentSection].play();

        // Start overlay video when entering frame-14a
        if (currentSection === 14) {
          // frame-14a index
          const overlayVideo = document.getElementById("overlay-video-14a");
          if (overlayVideo) {
            overlayVideo.currentTime = 0;
            overlayVideo
              .play()
              .catch((e) => console.log("Overlay video play failed:", e));
          }
        }

        // Frame2: hanya bisa lanjut ke frame3 (tidak bisa mundur)
        if (currentSection === 1) {
          enableScrollToContinueForward(2);
          // Frame3 sampai frame17: bisa maju/mundur dengan scroll/swipe
        } else if (currentSection > 1 && currentSection < sections.length - 1) {
          enableScrollToNavigate(currentSection);
        }
      }

      // Autoplay frame pertama
      sections.forEach((s, i) => {
        if (i !== 0) s.style.display = "none";
      });
      videos[0].play();

      // Setup overlay video untuk frame-14a
      document.addEventListener("DOMContentLoaded", function () {
        const overlayVideo = document.getElementById("overlay-video-14a");

        if (overlayVideo) {
          // Mencegah pause dengan event listener
          overlayVideo.addEventListener("pause", function () {
            if (currentSection === 14) {
              // hanya jika sedang di frame-14a
              overlayVideo
                .play()
                .catch((e) => console.log("Resume overlay video failed:", e));
            }
          });

          // Mencegah klik untuk pause
          overlayVideo.addEventListener("click", function (e) {
            e.preventDefault();
            e.stopPropagation();
            return false;
          });

          // Mencegah context menu
          overlayVideo.addEventListener("contextmenu", function (e) {
            e.preventDefault();
            return false;
          });

          // Pastikan video selalu loop dan autoplay
          overlayVideo.addEventListener("ended", function () {
            if (currentSection === 14) {
              overlayVideo.currentTime = 0;
              overlayVideo
                .play()
                .catch((e) => console.log("Restart overlay video failed:", e));
            }
          });

          // Monitor jika video berhenti karena alasan lain
          setInterval(function () {
            if (currentSection === 14 && overlayVideo.paused) {
              overlayVideo
                .play()
                .catch((e) =>
                  console.log("Keep overlay video playing failed:", e)
                );
            }
          }, 1000);
        }
      });
      // Countdown pada frame-4
      // Ganti tanggal di bawah sesuai tanggal acara (format: YYYY-MM-DDTHH:MM:SS)
      const countdownTarget = new Date("2025-08-10T10:00:00");
      const daysSpan = document.getElementById("days");
      const hoursSpan = document.getElementById("hours");
      const minutesSpan = document.getElementById("minutes");
      const secondsSpan = document.getElementById("seconds");

      function updateCountdown() {
        const now = new Date();
        let diff = Math.max(0, countdownTarget - now);
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        diff -= days * (1000 * 60 * 60 * 24);
        const hours = Math.floor(diff / (1000 * 60 * 60));
        diff -= hours * (1000 * 60 * 60);
        const minutes = Math.floor(diff / (1000 * 60));
        diff -= minutes * (1000 * 60);
        const seconds = Math.floor(diff / 1000);

        daysSpan.textContent = days.toString().padStart(2, "0");
        hoursSpan.textContent = hours.toString().padStart(2, "0");
        minutesSpan.textContent = minutes.toString().padStart(2, "0");
        secondsSpan.textContent = seconds.toString().padStart(2, "0");
      }
      setInterval(updateCountdown, 1000);
      updateCountdown();

      // Fungsi Save to Calendar
      function saveToCalendar() {
        // Data acara pernikahan
        const eventData = {
          title: "Pernikahan",
          startDate: "2025-08-10T08:00:00",
          endDate: "2025-08-10T14:00:00",
          description: "Acara pernikahan - Undangan pernikahan",
          location: "Jl. RA Fadilah, Gedung Balai Komando, Jakarta Timur",
        };

        // Format tanggal untuk berbagai platform
        const startDate = new Date(eventData.startDate);
        const endDate = new Date(eventData.endDate);

        // Format untuk Google Calendar (YYYYMMDDTHHMMSSZ)
        const formatDateForGoogle = (date) => {
          return date.toISOString().replace(/[-:]/g, "").split(".")[0] + "Z";
        };

        const googleStartDate = formatDateForGoogle(startDate);
        const googleEndDate = formatDateForGoogle(endDate);

        // Deteksi device dan buka calendar yang sesuai
        const userAgent = navigator.userAgent;

        if (/iPhone|iPad|iPod/.test(userAgent)) {
          // iOS - buka Apple Calendar
          const icsContent = [
            "BEGIN:VCALENDAR",
            "VERSION:2.0",
            "PRODID:-//Wedding Invitation//EN",
            "BEGIN:VEVENT",
            `DTSTART:${googleStartDate}`,
            `DTEND:${googleEndDate}`,
            `SUMMARY:${eventData.title}`,
            `DESCRIPTION:${eventData.description}`,
            `LOCATION:${eventData.location}`,
            "END:VEVENT",
            "END:VCALENDAR",
          ].join("\n");

          const blob = new Blob([icsContent], { type: "text/calendar" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "wedding-invitation.ics";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        } else if (/Android/.test(userAgent)) {
          // Android - buka Google Calendar
          const googleCalendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(
            eventData.title
          )}&dates=${googleStartDate}/${googleEndDate}&details=${encodeURIComponent(
            eventData.description
          )}&location=${encodeURIComponent(eventData.location)}`;
          window.open(googleCalendarUrl, "_blank");
        } else {
          // Desktop - buka Google Calendar
          const googleCalendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(
            eventData.title
          )}&dates=${googleStartDate}/${googleEndDate}&details=${encodeURIComponent(
            eventData.description
          )}&location=${encodeURIComponent(eventData.location)}`;
          window.open(googleCalendarUrl, "_blank");
        }
      }

      // Fungsi untuk mencegah viewport resize saat keyboard muncul
      function preventViewportResize() {
        const initialViewportHeight = window.innerHeight;

        // Set CSS custom property untuk height yang konsisten
        document.documentElement.style.setProperty(
          "--vh",
          `${initialViewportHeight * 0.01}px`
        );

        // Event listener untuk resize
        window.addEventListener("resize", function () {
          // Jangan update height jika perbedaan terlalu besar (kemungkinan keyboard)
          const currentHeight = window.innerHeight;
          if (Math.abs(currentHeight - initialViewportHeight) < 100) {
            document.documentElement.style.setProperty(
              "--vh",
              `${currentHeight * 0.01}px`
            );
          }
        });

        // Untuk iOS, tambahan handling
        if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
          document.addEventListener("focusin", function (e) {
            document.body.style.position = "fixed";
            document.body.style.width = "100%";
            document.body.style.height = "100%";
            document.body.style.overflow = "hidden";

            // Scroll ke atas untuk memastikan input terlihat
            window.scrollTo(0, 0);
          });

          document.addEventListener("focusout", function () {
            document.body.style.position = "";
            document.body.style.width = "";
            document.body.style.height = "";
            document.body.style.overflow = "";
          });
        }

        // Untuk Android
        if (/Android/.test(navigator.userAgent)) {
          let isKeyboardOpen = false;

          window.addEventListener("resize", function () {
            const heightDiff = initialViewportHeight - window.innerHeight;

            if (heightDiff > 150) {
              // Keyboard terbuka
              if (!isKeyboardOpen) {
                isKeyboardOpen = true;
                document.body.style.height = `${initialViewportHeight}px`;
                document.body.style.overflow = "hidden";
              }
            } else {
              // Keyboard tertutup
              if (isKeyboardOpen) {
                isKeyboardOpen = false;
                document.body.style.height = "";
                document.body.style.overflow = "";
              }
            }
          });
        }
      }

      // Panggil fungsi saat halaman dimuat
      preventViewportResize();

      // Fungsi untuk mengontrol musik background
      function toggleBackgroundMusic() {
        const musicIcon = document.getElementById("music-icon");
        const musicControl = document.getElementById("music-control");

        if (backgroundMusic.paused) {
          backgroundMusic.play().catch((error) => {
            console.log("Error playing music:", error);
          });
          musicIcon.textContent = "🔊";
          musicControl.style.background = "rgba(0, 0, 0, 0.5)";
        } else {
          backgroundMusic.pause();
          musicIcon.textContent = "🔇";
          musicControl.style.background = "rgba(255, 0, 0, 0.5)";
        }
      }

      // Update icon musik saat musik dimulai dari frame-1
      function updateMusicIcon() {
        const musicIcon = document.getElementById("music-icon");
        const musicControl = document.getElementById("music-control");

        if (!backgroundMusic.paused) {
          musicIcon.textContent = "🔊";
          musicControl.style.background = "rgba(0, 0, 0, 0.5)";
        }
      }

      // Pastikan musik tetap berjalan saat navigasi antar frame
      function ensureMusicPlaying() {
        if (backgroundMusic.paused && currentSection > 0) {
          backgroundMusic.play().catch((error) => {
            console.log("Error resuming music:", error);
          });
        }
      }

      // Update goToSection untuk memastikan musik tetap berjalan
      const originalGoToSection = goToSection;
      goToSection = function (idx) {
        originalGoToSection(idx);
        // Pastikan musik tetap berjalan setelah navigasi
        setTimeout(() => {
          ensureMusicPlaying();
        }, 100);
      };
    </script>
    <script>
      // Fungsi untuk mengelola data harapan dan kehadiran menggunakan IndexedDB
      let hopesData = [];
      let attendanceData = {};
      let db;

      // Inisialisasi IndexedDB
      function initDB() {
        return new Promise((resolve, reject) => {
          const request = indexedDB.open("WeddingInvitationDB", 1);

          request.onerror = () => {
            console.log("IndexedDB error:", request.error);
            // Fallback ke localStorage jika IndexedDB gagal
            loadFromLocalStorage();
            resolve();
          };

          request.onsuccess = () => {
            db = request.result;
            loadFromIndexedDB().then(resolve);
          };

          request.onupgradeneeded = (event) => {
            db = event.target.result;

            // Create object stores
            if (!db.objectStoreNames.contains("hopes")) {
              const hopesStore = db.createObjectStore("hopes", {
                keyPath: "id",
                autoIncrement: true,
              });
              hopesStore.createIndex("timestamp", "timestamp", {
                unique: false,
              });
            }

            if (!db.objectStoreNames.contains("attendance")) {
              db.createObjectStore("attendance", { keyPath: "id" });
            }

            if (!db.objectStoreNames.contains("sync")) {
              db.createObjectStore("sync", { keyPath: "id" });
            }
          };
        });
      }

      // Load data dari IndexedDB
      function loadFromIndexedDB() {
        return new Promise((resolve) => {
          if (!db) {
            loadFromLocalStorage();
            resolve();
            return;
          }

          const transaction = db.transaction(
            ["hopes", "attendance"],
            "readonly"
          );
          const hopesStore = transaction.objectStore("hopes");
          const attendanceStore = transaction.objectStore("attendance");

          // Load hopes
          hopesStore.getAll().onsuccess = (event) => {
            hopesData = event.target.result || [];

            // Load attendance
            attendanceStore.get("user-attendance").onsuccess = (event) => {
              attendanceData = event.target.result
                ? event.target.result.data
                : {};
              updateDisplay();
              resolve();
            };
          };
        });
      }

      // Fallback ke localStorage
      function loadFromLocalStorage() {
        hopesData = JSON.parse(localStorage.getItem("wedding-hopes") || "[]");
        attendanceData = JSON.parse(
          localStorage.getItem("wedding-attendance") || "{}"
        );
        updateDisplay();
      }

      // Simpan ke IndexedDB
      function saveToIndexedDB(hope) {
        return new Promise((resolve, reject) => {
          if (!db) {
            // Fallback ke localStorage
            hopesData.push(hope);
            localStorage.setItem("wedding-hopes", JSON.stringify(hopesData));
            resolve();
            return;
          }

          const transaction = db.transaction(["hopes"], "readwrite");
          const store = transaction.objectStore("hopes");

          const request = store.add(hope);
          request.onsuccess = () => {
            hopesData.push({ ...hope, id: request.result });

            // Sync to localStorage as backup
            localStorage.setItem("wedding-hopes", JSON.stringify(hopesData));
            resolve();
          };
          request.onerror = () => {
            console.log("IndexedDB save error, using localStorage");
            hopesData.push(hope);
            localStorage.setItem("wedding-hopes", JSON.stringify(hopesData));
            resolve();
          };
        });
      }

      // Simpan attendance ke IndexedDB
      function saveAttendanceToIndexedDB(data) {
        return new Promise((resolve) => {
          if (!db) {
            localStorage.setItem("wedding-attendance", JSON.stringify(data));
            resolve();
            return;
          }

          const transaction = db.transaction(["attendance"], "readwrite");
          const store = transaction.objectStore("attendance");

          const request = store.put({ id: "user-attendance", data: data });
          request.onsuccess = () => {
            localStorage.setItem("wedding-attendance", JSON.stringify(data));
            resolve();
          };
          request.onerror = () => {
            localStorage.setItem("wedding-attendance", JSON.stringify(data));
            resolve();
          };
        });
      }

      // Sync data antar device (simulasi cloud sync)
      function syncData() {
        // Ini bisa dikembangkan untuk sync ke server atau cloud storage
        // Untuk sekarang, kita gunakan localStorage dan IndexedDB sebagai backup
        console.log("Data synced locally");
      }

      // Menyimpan data saat input berubah
      function saveData() {
        const nameInput = document.getElementById("frame16-input");
        const hopeInput = document.getElementById("frame16-input-2");
        const attendanceRadio = document.querySelector(
          'input[name="kehadiran"]:checked'
        );

        if (nameInput.value.trim() && hopeInput.value.trim()) {
          const newHope = {
            name: nameInput.value.trim(),
            message: hopeInput.value.trim(),
            attendance: attendanceRadio ? attendanceRadio.value : "",
            timestamp: new Date().toISOString(),
            deviceId: generateDeviceId(),
          };

          saveToIndexedDB(newHope).then(() => {
            updateDisplay();
            syncData();
          });

          // Clear inputs setelah save
          nameInput.value = "";
          hopeInput.value = "";
          if (attendanceRadio) attendanceRadio.checked = false;
        }
      }

      // Generate unique device ID
      function generateDeviceId() {
        let deviceId = localStorage.getItem("wedding-device-id");
        if (!deviceId) {
          deviceId =
            "device-" +
            Date.now() +
            "-" +
            Math.random().toString(36).substr(2, 9);
          localStorage.setItem("wedding-device-id", deviceId);
        }
        return deviceId;
      }

      // Menyimpan data kehadiran
      function saveAttendance() {
        const attendanceRadio = document.querySelector(
          'input[name="kehadiran"]:checked'
        );
        if (attendanceRadio) {
          attendanceData.selection = attendanceRadio.value;
          attendanceData.timestamp = new Date().toISOString();
          attendanceData.deviceId = generateDeviceId();

          saveAttendanceToIndexedDB(attendanceData);
          syncData();
        }
      }

      // Memuat data saat halaman dimuat
      function loadData() {
        // Restore radio button selection
        if (attendanceData.selection) {
          const radio = document.querySelector(
            `input[name="kehadiran"][value="${attendanceData.selection}"]`
          );
          if (radio) radio.checked = true;
        }

        updateDisplay();
      }

      // Update tampilan counter dan list
      function updateDisplay() {
        const counterElement = document.getElementById("counter-number");
        const hopesListElement = document.getElementById("hopes-list");

        if (counterElement) {
          counterElement.textContent = hopesData.length;
        }

        if (hopesListElement) {
          if (hopesData.length === 0) {
            hopesListElement.innerHTML = `
              <p style="
                color: #9a2828;
                font-size: 10px;
                font-family: sans-serif;
                text-align: center;
                margin: 0;
                font-style: italic;
              ">Belum ada harapan yang ditulis</p>
            `;
          } else {
            hopesListElement.innerHTML = hopesData
              .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
              .map(
                (hope, index) => `
              <div style="
                background: rgba(154, 40, 40, 0.1);
                border-radius: 5px;
                padding: 8px;
                margin-bottom: 8px;
                border-left: 3px solid rgba(154, 40, 40, 0.5);
              ">
                <p style="
                  color: #9a2828;
                  font-size: 9px;
                  font-family: sans-serif;
                  margin: 0 0 3px 0;
                  font-weight: bold;
                  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
                ">${hope.name}</p>
                <p style="
                  color: #b73838;
                  font-size: 8px;
                  font-family: sans-serif;
                  margin: 0;
                  line-height: 1.3;
                  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
                ">${hope.message}</p>
                <p style="
                  color: #666;
                  font-size: 6px;
                  font-family: sans-serif;
                  margin: 2px 0 0 0;
                  font-style: italic;
                ">${new Date(hope.timestamp).toLocaleString("id-ID")}</p>
              </div>
            `
              )
              .join("");
          }
        }
      }

      // Export data ke file JSON
      function exportData() {
        const allData = {
          hopes: hopesData,
          attendance: attendanceData,
          exportDate: new Date().toISOString(),
          version: "1.0",
        };

        const dataStr = JSON.stringify(allData, null, 2);
        const dataBlob = new Blob([dataStr], { type: "application/json" });

        const link = document.createElement("a");
        link.href = URL.createObjectURL(dataBlob);
        link.download = `wedding-hopes-${
          new Date().toISOString().split("T")[0]
        }.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      // Import data dari file JSON
      function importData(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const importedData = JSON.parse(e.target.result);

            if (importedData.hopes && Array.isArray(importedData.hopes)) {
              // Merge dengan data yang sudah ada
              const existingIds = hopesData.map((h) => h.timestamp + h.name);
              const newHopes = importedData.hopes.filter(
                (h) => !existingIds.includes(h.timestamp + h.name)
              );

              hopesData = [...hopesData, ...newHopes];

              // Save to IndexedDB
              newHopes.forEach((hope) => {
                saveToIndexedDB(hope);
              });

              if (importedData.attendance) {
                attendanceData = {
                  ...attendanceData,
                  ...importedData.attendance,
                };
                saveAttendanceToIndexedDB(attendanceData);
              }

              updateDisplay();
              alert(`Berhasil mengimpor ${newHopes.length} harapan baru!`);
            }
          } catch (error) {
            alert("File tidak valid atau rusak!");
            console.error("Import error:", error);
          }
        };
        reader.readAsText(file);
      }

      // Tambahkan tombol export/import (bisa diaktifkan dengan shortcut)
      document.addEventListener("keydown", function (e) {
        // Ctrl+E untuk export
        if (e.ctrlKey && e.key === "e") {
          e.preventDefault();
          exportData();
        }
        // Ctrl+I untuk import
        if (e.ctrlKey && e.key === "i") {
          e.preventDefault();
          const input = document.createElement("input");
          input.type = "file";
          input.accept = ".json";
          input.onchange = importData;
          input.click();
        }
      });

      // Fungsi untuk mengirim data
      function submitData() {
        const nameInput = document.getElementById("frame16-input");
        const hopeInput = document.getElementById("frame16-input-2");
        const attendanceRadio = document.querySelector(
          'input[name="kehadiran"]:checked'
        );
        const submitBtn = document.getElementById("submit-btn");

        // Validasi input
        if (!nameInput.value.trim()) {
          alert("Mohon isi nama Anda!");
          nameInput.focus();
          return;
        }

        if (!hopeInput.value.trim()) {
          alert("Mohon isi harapan Anda!");
          hopeInput.focus();
          return;
        }

        if (!attendanceRadio) {
          alert("Mohon pilih konfirmasi kehadiran!");
          return;
        }

        // Simpan data
        const newHope = {
          name: nameInput.value.trim(),
          message: hopeInput.value.trim(),
          attendance: attendanceRadio.value,
          timestamp: new Date().toISOString(),
          deviceId: generateDeviceId(),
        };

        // Feedback visual pada button
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = "⏳ Menyimpan...";
        submitBtn.style.background =
          "linear-gradient(135deg, #f59e0b, #d97706)";
        submitBtn.disabled = true;

        saveToIndexedDB(newHope)
          .then(() => {
            // Update tampilan
            updateDisplay();
            syncData();

            // Success feedback
            submitBtn.innerHTML = "✓ Terkirim!";
            submitBtn.style.background =
              "linear-gradient(135deg, #22c55e, #16a34a)";

            // Reset form
            nameInput.value = "";
            hopeInput.value = "";
            attendanceRadio.checked = false;

            // Reset button setelah 2 detik
            setTimeout(() => {
              submitBtn.innerHTML = originalText;
              submitBtn.style.background =
                "linear-gradient(135deg, #9a2828, #c53030)";
              submitBtn.disabled = false;
            }, 2000);
          })
          .catch((error) => {
            console.error("Error saving data:", error);

            // Error feedback
            submitBtn.innerHTML = "❌ Gagal!";
            submitBtn.style.background =
              "linear-gradient(135deg, #dc2626, #b91c1c)";

            setTimeout(() => {
              submitBtn.innerHTML = originalText;
              submitBtn.style.background =
                "linear-gradient(135deg, #9a2828, #c53030)";
              submitBtn.disabled = false;
            }, 2000);
          });
      }

      // Event listeners
      document.addEventListener("DOMContentLoaded", function () {
        // Initialize database first
        initDB().then(() => {
          const attendanceRadios = document.querySelectorAll(
            'input[name="kehadiran"]'
          );

          attendanceRadios.forEach((radio) => {
            radio.addEventListener("change", saveAttendance);
          });

          loadData();
        });
      });
    </script>
  </body>
</html>
