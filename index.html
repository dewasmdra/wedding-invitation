<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>Undangan Pernikahan Adinda & Yatno</title>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        width: 100vw;
        height: 100vh;
        overflow: hidden !important;
        background: #000;
        touch-action: none;
        overscroll-behavior: none;
        -webkit-overflow-scrolling: auto;
        scrollbar-width: none;
        /* Tambahkan ini untuk mencegah resize saat keyboard muncul */
        position: fixed;
      }

      /* Tambahkan CSS khusus untuk input agar tidak terpengaruh keyboard */
      .input-container {
        position: fixed !important;
        z-index: 10;
      }

      /* CSS untuk mencegah viewport resize */
      @supports (-webkit-touch-callout: none) {
        .frame-section {
          height: 100vh !important;
          height: -webkit-fill-available !important;
        }

        /* Khusus untuk iOS Safari */
        body {
          position: fixed !important;
          width: 100% !important;
          height: 100% !important;
        }
      }

      /* Mencegah keyboard menggeser layout */
      @media screen and (max-height: 500px) {
        html,
        body {
          height: 100vh !important;
          overflow: hidden !important;
        }
      }

      body::-webkit-scrollbar,
      html::-webkit-scrollbar {
        display: none;
      }
      video {
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        background: #000;
        display: block;
        /* Mobile optimizations */
        height: -webkit-fill-available;
        will-change: transform;
        transform: translateZ(0);
        -webkit-transform: translateZ(0);
      }

      /* Mobile-specific optimizations */
      @media (max-width: 768px) {
        * {
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

        video {
          /* Reduce video quality on low-end devices */
          image-rendering: optimizeSpeed;
          image-rendering: -moz-crisp-edges;
          image-rendering: -webkit-optimize-contrast;
        }

        /* Optimize input rendering */
        input,
        button {
          -webkit-appearance: none;
          appearance: none;
          border-radius: 0;
          transform: translateZ(0);
        }

        /* Override appearance for radio buttons to make them visible */
        input[type="radio"] {
          -webkit-appearance: radio !important;
          appearance: radio !important;
          width: auto !important;
          height: auto !important;
        }

        /* Optimize animations */
        .frame-section {
          -webkit-backface-visibility: hidden;
          backface-visibility: hidden;
          will-change: transform;
        }
      }

      /* Low-end device optimizations */
      @media (max-width: 480px) and (max-height: 800px) {
        video {
          /* Further reduce quality for very low-end devices */
          image-rendering: pixelated;
        }

        /* Reduce shadow effects */
        * {
          text-shadow: none !important;
          box-shadow: none !important;
        }

        /* Simplify gradients */
        button {
          background: #9a2828 !important;
        }
      }
      @media (min-width: 600px) {
        body::before {
          content: "Mohon buka undangan ini di perangkat mobile.";
          color: #fff;
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: #000c;
          z-index: 9999;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 2em;
          text-align: center;
        }
        main#invitation-sections {
          display: none;
        }
      }

      /* Pastikan radio button terlihat */
      input[type="radio"] {
        -webkit-appearance: radio !important;
        appearance: radio !important;
        width: 12px !important;
        height: 12px !important;
        border: 2px solid #9a2828 !important;
        border-radius: 50% !important;
        background: white !important;
        margin-right: 6px !important;
        flex-shrink: 0 !important;
        position: relative !important;
      }

      input[type="radio"]:checked {
        background: #9a2828 !important;
        border-color: #9a2828 !important;
      }

      input[type="radio"]:checked::before {
        content: "";
        display: block;
        width: 4px;
        height: 4px;
        border-radius: 50%;
        background: white;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }
    </style>
  </head>
  <body>
    <!-- Audio element untuk musik background -->
    <audio id="background-music" loop preload="auto">
      <source src="wedding-music.mp3" type="audio/mpeg" />
      <source src="wedding-music.ogg" type="audio/ogg" />
    </audio>

    <!-- Tombol kontrol musik -->
    <div
      id="music-control"
      style="
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
      "
      onclick="toggleBackgroundMusic()"
    >
      <span
        id="music-icon"
        style="color: white; font-size: 20px; user-select: none"
        >üîä</span
      >
    </div>

    <main id="invitation-sections">
      <section class="frame-section" id="frame-1" style="position: relative">
        <video
          src="frame.mp4"
          id="video1"
          playsinline
          muted
          webkit-playsinline
          preload="metadata"
        ></video>

        <!-- Button Buka Undangan -->
        <div
          style="
            position: absolute;
            bottom: 20%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3;
          "
        >
          <button
            id="open-invitation-btn"
            onclick="openInvitation()"
            style="
              background: linear-gradient(135deg, #9a2828, #c53030);
              color: #fff0b4;
              border: 2px solid rgba(255, 255, 255, 0.8);
              border-radius: 20px;
              margin-bottom: 50px;
              padding: 10px 20px;
              font-size: 14px;
              font-family: sans-serif;
              font-weight: bold;
              cursor: pointer;
              box-shadow: 0 4px 15px rgba(154, 40, 40, 0.4);
              transition: all 0.3s ease;
              outline: none;
              backdrop-filter: blur(10px);
              text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
              letter-spacing: 0.5px;
              min-width: 160px;
              max-width: 200px;
            "
            onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 20px rgba(154, 40, 40, 0.5)'"
            onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 15px rgba(154, 40, 40, 0.4)'"
            ontouchstart="this.style.transform='scale(0.95)'"
            ontouchend="this.style.transform='scale(1)'"
          >
            ‚úâÔ∏è Buka Undangan
          </button>
        </div>
      </section>
      <section class="frame-section" id="frame-2" style="display: none">
        <video
          src="frame2.mp4"
          id="video2"
          playsinline
          webkit-playsinline
          preload="auto"
          loop
        ></video>
      </section>
      <section class="frame-section" id="frame-3" style="display: none">
        <video
          src="frame3.mp4"
          id="video3"
          playsinline
          webkit-playsinline
          preload="auto"
          loop
        ></video>
      </section>
      <section
        class="frame-section"
        id="frame-4"
        style="display: none; position: relative"
      >
        <video
          src="frame4.mp4"
          id="video4"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
        <div
          id="countdown"
          style="
            position: absolute;
            z-index: 2;
            bottom: 15%;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 320px;
            text-align: center;
            color: #fff;
            font-size: 1.8em;
            font-family: sans-serif;
            text-shadow: 0 2px 8px #000;
            letter-spacing: 1px;
            display: flex;
            justify-content: center;
            gap: 0.4em;
            flex-wrap: wrap;
          "
        >
          <div
            style="
              display: flex;
              flex-direction: column;
              align-items: center;
              background: #6e2629;
              border-radius: 8px;
              padding: 10px 8px;
              box-shadow: 0 3px 15px rgba(0, 0, 0, 0.3);
              min-width: 45px;
            "
          >
            <span id="days" style="font-size: 1em; font-weight: bold">00</span>
            <span style="font-size: 0.35em; margin-top: -0.1em">HARI</span>
          </div>
          <div
            style="
              display: flex;
              flex-direction: column;
              align-items: center;
              background: #6e2629;
              border-radius: 8px;
              padding: 10px 8px;
              box-shadow: 0 3px 15px rgba(0, 0, 0, 0.3);
              min-width: 45px;
            "
          >
            <span id="hours" style="font-size: 1em; font-weight: bold">00</span>
            <span style="font-size: 0.35em; margin-top: -0.1em">JAM</span>
          </div>
          <div
            style="
              display: flex;
              flex-direction: column;
              align-items: center;
              background: #6e2629;
              border-radius: 8px;
              padding: 10px 8px;
              box-shadow: 0 3px 15px rgba(0, 0, 0, 0.3);
              min-width: 45px;
            "
          >
            <span id="minutes" style="font-size: 1em; font-weight: bold"
              >00</span
            >
            <span style="font-size: 0.35em; margin-top: -0.1em">MENIT</span>
          </div>
          <div
            style="
              display: flex;
              flex-direction: column;
              align-items: center;
              background: #6e2629;
              border-radius: 8px;
              padding: 10px 8px;
              box-shadow: 0 3px 15px rgba(0, 0, 0, 0.3);
              min-width: 45px;
            "
          >
            <span id="seconds" style="font-size: 1em; font-weight: bold"
              >00</span
            >
            <span style="font-size: 0.35em; margin-top: -0.1em">DETIK</span>
          </div>
        </div>

        <!-- Button Save to Calendar -->
        <div
          style="
            position: absolute;
            bottom: 5%;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3;
          "
        >
          <button
            onclick="saveToCalendar()"
            style="
              background: #6e2629;
              color: #fff0b4;
              border: 2px solid rgba(255, 255, 255, 0.8);
              border-radius: 25px;
              padding: 12px 20px;
              font-size: 12px;
              font-family: sans-serif;
              font-weight: bold;
              cursor: pointer;
              box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
              transition: all 0.3s ease;
              outline: none;
              backdrop-filter: blur(10px);
            "
            onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 20px rgba(0, 0, 0, 0.4)'"
            onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 15px rgba(0, 0, 0, 0.3)'"
            ontouchstart="this.style.transform='scale(0.95)'"
            ontouchend="this.style.transform='scale(1)'"
          >
            üìÖ Save to Calendar
          </button>
        </div>
      </section>
      <section class="frame-section" id="frame-5" style="display: none">
        <video
          src="frame5.mp4"
          id="video5"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
      <section class="frame-section" id="frame-6" style="display: none">
        <video
          src="frame6.mp4"
          id="video6"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
      <section class="frame-section" id="frame-7" style="display: none">
        <video
          src="frame7.mp4"
          id="video7"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
      <section
        class="frame-section"
        id="frame-8"
        style="display: none; position: relative"
      >
        <video
          src="frame8.mp4"
          id="video8"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
        <a
          href="https://maps.app.goo.gl/EYmAUsSa9VuHvsRW9"
          target="_blank"
          style="
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50%;
            height: 35%;
            z-index: 2;
            display: block;
          "
        ></a>
      </section>
      <section
        class="frame-section"
        id="frame-9"
        style="display: none; position: relative"
      >
        <video
          src="frame9.mp4"
          id="video9"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
        <a
          href="https://maps.app.goo.gl/EYmAUsSa9VuHvsRW9"
          target="_blank"
          style="
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50%;
            height: 35%;
            z-index: 2;
            display: block;
          "
        ></a>
      </section>
      <section class="frame-section" id="frame-10" style="display: none">
        <video
          src="frame10.mp4"
          id="video10"
          playsinline
          webkit-playsinline
          loop
          preload="auto"
        ></video>
      </section>
      <section class="frame-section" id="frame-11" style="display: none">
        <video
          src="frame11.mp4"
          id="video11"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
      <section class="frame-section" id="frame-12" style="display: none">
        <video
          src="frame12.mp4"
          id="video12"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
      <section class="frame-section" id="frame-13" style="display: none">
        <video
          src="frame13.mp4"
          id="video13"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
      <section class="frame-section" id="frame-14" style="display: none">
        <video
          src="frame14.mp4"
          id="video14"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
      <section
        class="frame-section"
        id="frame-14a"
        style="display: none; position: relative"
      >
        <video
          src="frame14-test.mp4"
          id="video14a"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
        <!-- Video overlay di tengah -->
        <video
          id="overlay-video-14a"
          src="ads.mp4"
          style="
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 300px;
            height: auto;
            z-index: 3;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);
            pointer-events: none;
          "
          autoplay
          loop
          muted
          playsinline
          webkit-playsinline
          preload="auto"
          disablePictureInPicture
          controlslist="nodownload nofullscreen noremoteplaybook"
        ></video>
      </section>
      <section class="frame-section" id="frame-15" style="display: none">
        <video
          src="frame15.mp4"
          id="video15"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
      <section
        class="frame-section"
        id="frame-16"
        style="display: none; position: relative"
      >
        <video
          src="frame16.mp4"
          id="video16"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
        <input
          type="text"
          id="frame16-input"
          placeholder="Tulis nama Anda..."
          style="
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 200px;
            padding: 5px 15px;
            border: 2px solid rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 16px;
            font-family: sans-serif;
            outline: none;
            z-index: 10;
          "
        />
        <input
          type="text"
          id="frame16-input-2"
          placeholder="Tulis harapan Anda..."
          style="
            position: fixed;
            top: 150px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 200px;
            padding: 5px 15px;
            border: 2px solid rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 16px;
            font-family: sans-serif;
            outline: none;
            z-index: 10;
          "
        />
        <div
          style="
            position: fixed;
            top: 200px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 200px;
            text-align: center;
            z-index: 10;
          "
        >
          <p
            style="
              color: #9a2828;
              font-size: 14px;
              font-family: sans-serif;
              margin: 0 0 10px 0;
              text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
            "
          >
            Konfirmasi
          </p>
          <div
            style="
              display: flex;
              justify-content: start;
              gap: 5px;
              flex-wrap: wrap;
              flex-direction: column;
              align-items: start;
            "
          >
            <label
              style="
                display: flex;
                align-items: center;
                color: #9a2828;
                font-size: 12px;
                font-family: sans-serif;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
                cursor: pointer;
                margin-bottom: 8px;
              "
            >
              <input
                type="radio"
                name="kehadiran"
                value="hadir, 1 orang"
                style="
                  margin-right: 6px;
                  transform: scale(1);
                  -webkit-appearance: radio !important;
                  appearance: radio !important;
                "
              />
              Hadir (1 orang)
            </label>
            <label
              style="
                display: flex;
                align-items: center;
                color: #9a2828;
                font-size: 12px;
                font-family: sans-serif;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
                cursor: pointer;
                margin-bottom: 8px;
              "
            >
              <input
                type="radio"
                name="kehadiran"
                value="hadir, lebih dari 1 orang"
                style="
                  margin-right: 6px;
                  transform: scale(1);
                  -webkit-appearance: radio !important;
                  appearance: radio !important;
                "
              />
              Hadir (lebih dari 1 orang)
            </label>
            <label
              style="
                display: flex;
                align-items: center;
                color: #9a2828;
                font-size: 12px;
                font-family: sans-serif;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
                cursor: pointer;
              "
            >
              <input
                type="radio"
                name="kehadiran"
                value="tidak hadir"
                style="
                  margin-right: 6px;
                  transform: scale(1);
                  -webkit-appearance: radio !important;
                  appearance: radio !important;
                "
              />
              Tidak Hadir
            </label>
          </div>
        </div>

        <!-- Button untuk mengirim data -->
        <div
          style="
            position: fixed;
            top: 500px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 200px;
            text-align: center;
            z-index: 10;
          "
        >
          <button
            id="submit-btn"
            onclick="submitData()"
            style="
              background: linear-gradient(135deg, #9a2828, #c53030);
              color: white;
              border: none;
              border-radius: 25px;
              padding: 12px 25px;
              font-size: 14px;
              font-family: sans-serif;
              font-weight: bold;
              cursor: pointer;
              box-shadow: 0 4px 15px rgba(154, 40, 40, 0.3);
              transition: all 0.3s ease;
              width: 100%;
              max-width: 150px;
              outline: none;
            "
            onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 6px 20px rgba(154, 40, 40, 0.4)'"
            onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 15px rgba(154, 40, 40, 0.3)'"
            ontouchstart="this.style.transform='scale(0.95)'"
            ontouchend="this.style.transform='scale(1)'"
          >
            Kirim Harapan
          </button>
        </div>

        <!-- Counter dan daftar harapan -->
        <div
          style="
            position: fixed;
            top: 340px;
            left: 50%;
            transform: translateX(-50%);
            width: 75%;
            max-width: 250px;
            text-align: center;
            z-index: 10;
          "
        >
          <p
            id="hopes-counter"
            style="
              color: #9a2828;
              font-size: 12px;
              font-family: sans-serif;
              margin: 0 0 15px 0;
              text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
            "
          >
            Total Harapan: <span id="counter-number">0</span>
          </p>

          <div
            id="hopes-list"
            style="
              max-height: 150px;
              overflow-y: auto;
              border-radius: 8px;
              padding: 6px;
              text-align: left;
            "
          >
            <p
              style="
                color: #9a2828;
                font-size: 10px;
                font-family: sans-serif;
                text-align: center;
                margin: 0;
                font-style: italic;
              "
            >
              Belum ada harapan yang ditulis
            </p>
          </div>
        </div>
      </section>
      <section class="frame-section" id="frame-17" style="display: none">
        <video
          src="frame17.mp4"
          id="video17"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
      <section class="frame-section" id="frame-18" style="display: none">
        <video
          src="frame18.mp4"
          id="video18"
          playsinline
          webkit-playsinline
          preload="auto"
        ></video>
      </section>
    </main>
    <style>
      .frame-section {
        width: 100vw;
        height: 100vh;
        height: calc(var(--vh, 1vh) * 100);
        display: flex;
        align-items: center;
        justify-content: center;
        background: #000;
        position: fixed;
        top: 0;
        left: 0;
      }
      .frame-section video {
        width: 100vw;
        height: 100vh;
        height: calc(var(--vh, 1vh) * 100);
        object-fit: cover;
      }
    </style>
    <script>
      // Mobile Performance Optimization
      const isMobile =
        /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
          navigator.userAgent
        );
      const isLowEndDevice =
        navigator.hardwareConcurrency <= 2 || navigator.deviceMemory <= 2;

      // Throttle function untuk touch events
      function throttle(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      // Lazy loading untuk video
      function preloadNextVideo(currentIndex) {
        const nextIndex = currentIndex + 1;
        if (nextIndex < videos.length && videos[nextIndex]) {
          const nextVideo = videos[nextIndex];
          if (nextVideo.preload === "none") {
            nextVideo.preload = "metadata";
            nextVideo.load();
          }
        }
      }

      // Cleanup video memory untuk device dengan memory terbatas
      function cleanupPreviousVideo(currentIndex) {
        if (isLowEndDevice) {
          const prevIndex = currentIndex - 2; // Keep previous video in memory
          if (prevIndex >= 0 && videos[prevIndex]) {
            const prevVideo = videos[prevIndex];
            prevVideo.preload = "none";
            prevVideo.src = prevVideo.src; // Reset to free memory
          }
        }
      }

      // Navigasi antar section/frame
      const sections = [
        document.getElementById("frame-1"),
        document.getElementById("frame-2"),
        document.getElementById("frame-3"),
        document.getElementById("frame-4"),
        document.getElementById("frame-5"),
        document.getElementById("frame-6"),
        document.getElementById("frame-7"),
        document.getElementById("frame-8"),
        document.getElementById("frame-9"),
        document.getElementById("frame-10"),
        document.getElementById("frame-11"),
        document.getElementById("frame-12"),
        document.getElementById("frame-13"),
        document.getElementById("frame-14"),
        document.getElementById("frame-14a"),
        document.getElementById("frame-15"),
        document.getElementById("frame-16"),
        document.getElementById("frame-17"),
        document.getElementById("frame-18"),
      ];
      const videos = [
        document.getElementById("video1"),
        document.getElementById("video2"),
        document.getElementById("video3"),
        document.getElementById("video4"),
        document.getElementById("video5"),
        document.getElementById("video6"),
        document.getElementById("video7"),
        document.getElementById("video8"),
        document.getElementById("video9"),
        document.getElementById("video10"),
        document.getElementById("video11"),
        document.getElementById("video12"),
        document.getElementById("video13"),
        document.getElementById("video14"),
        document.getElementById("video14a"),
        document.getElementById("video15"),
        document.getElementById("video16"),
        document.getElementById("video17"),
        document.getElementById("video18"),
      ];
      let currentSection = 0;

      // Frame 1: tunggu klik pada video atau button
      const backgroundMusic = document.getElementById("background-music");

      // Fungsi untuk membuka undangan (dari button)
      function openInvitation() {
        // Mulai memutar musik background
        backgroundMusic
          .play()
          .then(() => {
            updateMusicIcon();
          })
          .catch((error) => {
            console.log("Auto-play music blocked by browser:", error);
          });

        // Pindah ke frame selanjutnya
        goToSection(1);
      }

      videos[0].addEventListener("play", () => {
        videos[0].addEventListener(
          "click",
          () => {
            openInvitation();
          },
          { once: true }
        );
      });

      // Fungsi scroll/swipe untuk frame2 (hanya bisa lanjut ke frame3)
      function enableScrollToContinueForward(targetSection) {
        let startY = null;
        let isNavigating = false;

        const throttledTouchStart = throttle((e) => {
          if (!isNavigating) {
            startY = e.touches ? e.touches[0].clientY : e.clientY;
          }
        }, 50);

        const throttledTouchEnd = throttle((e) => {
          if (isNavigating) return;

          let endY = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
          if (startY !== null && startY - endY > 50) {
            isNavigating = true;
            removeScrollListeners();
            preloadNextVideo(targetSection);
            goToSection(targetSection);
          }
        }, 100);

        const throttledWheel = throttle((e) => {
          if (isNavigating) return;

          if (e.deltaY > 30) {
            isNavigating = true;
            removeScrollListeners();
            preloadNextVideo(targetSection);
            goToSection(targetSection);
          }
        }, 100);

        function removeScrollListeners() {
          window.removeEventListener("touchstart", throttledTouchStart);
          window.removeEventListener("touchend", throttledTouchEnd);
          window.removeEventListener("wheel", throttledWheel);
        }

        window.addEventListener("touchstart", throttledTouchStart, {
          passive: true,
        });
        window.addEventListener("touchend", throttledTouchEnd, {
          passive: true,
        });
        window.addEventListener("wheel", throttledWheel, { passive: true });
      }

      // Fungsi scroll/swipe untuk frame3 sampai frame18 (bisa maju/mundur)
      function enableScrollToNavigate(idx) {
        let startY = null;
        let isNavigating = false;

        const throttledTouchStart = throttle((e) => {
          if (!isNavigating) {
            startY = e.touches ? e.touches[0].clientY : e.clientY;
          }
        }, 50);

        const throttledTouchEnd = throttle((e) => {
          if (isNavigating) return;

          let endY = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
          if (startY !== null && Math.abs(endY - startY) > 50) {
            isNavigating = true;
            removeScrollListeners();

            if (startY > endY && idx < sections.length - 1) {
              preloadNextVideo(idx + 1);
              goToSection(idx + 1); // scroll down
            } else if (startY < endY && idx > 1) {
              goToSection(idx - 1); // scroll up (tidak bisa ke frame1)
            }
          }
        }, 100);

        const throttledWheel = throttle((e) => {
          if (isNavigating) return;

          if (e.deltaY > 30 && idx < sections.length - 1) {
            isNavigating = true;
            removeScrollListeners();
            preloadNextVideo(idx + 1);
            goToSection(idx + 1);
          } else if (e.deltaY < -30 && idx > 1) {
            isNavigating = true;
            removeScrollListeners();
            goToSection(idx - 1);
          }
        }, 100);

        function removeScrollListeners() {
          window.removeEventListener("touchstart", throttledTouchStart);
          window.removeEventListener("touchend", throttledTouchEnd);
          window.removeEventListener("wheel", throttledWheel);
        }

        window.addEventListener("touchstart", throttledTouchStart, {
          passive: true,
        });
        window.addEventListener("touchend", throttledTouchEnd, {
          passive: true,
        });
        window.addEventListener("wheel", throttledWheel, { passive: true });
      }

      function goToSection(idx) {
        if (idx < 0 || idx >= sections.length) return;

        // Pause dan hide current section
        sections[currentSection].style.display = "none";
        videos[currentSection].pause();

        // Cleanup previous videos untuk menghemat memory
        cleanupPreviousVideo(idx);

        // Update current section
        currentSection = idx;
        sections[currentSection].style.display = "flex";

        // Load video jika belum di-preload
        const currentVideo = videos[currentSection];
        if (currentVideo.preload === "none") {
          currentVideo.preload = "metadata";
          currentVideo.load();
        }

        currentVideo.currentTime = 0;

        // Play video dengan error handling untuk mobile
        const playPromise = currentVideo.play();
        if (playPromise !== undefined) {
          playPromise.catch((error) => {
            console.log("Video play error:", error);
            // Retry setelah delay singkat
            setTimeout(() => {
              currentVideo.play().catch((e) => console.log("Retry failed:", e));
            }, 500);
          });
        }

        // Preload next video untuk smooth navigation
        preloadNextVideo(idx);

        // Setup navigation events
        if (currentSection === 1) {
          enableScrollToContinueForward(2);
        } else if (currentSection > 1 && currentSection < sections.length - 1) {
          enableScrollToNavigate(currentSection);
        }

        // Handle overlay video untuk frame-14a
        if (currentSection === 14) {
          // frame-14a index
          const overlayVideo = document.getElementById("overlay-video-14a");
          if (overlayVideo) {
            overlayVideo.currentTime = 0;
            overlayVideo.play().catch((error) => {
              console.log("Overlay video play error:", error);
            });
          }
        }
      }

      // Autoplay frame pertama
      sections.forEach((s, i) => {
        if (i !== 0) s.style.display = "none";
      });
      videos[0].play();
      // Countdown pada frame-4
      // Ganti tanggal di bawah sesuai tanggal acara (format: YYYY-MM-DDTHH:MM:SS)
      const countdownTarget = new Date("2025-08-10T10:00:00");
      const daysSpan = document.getElementById("days");
      const hoursSpan = document.getElementById("hours");
      const minutesSpan = document.getElementById("minutes");
      const secondsSpan = document.getElementById("seconds");

      function updateCountdown() {
        const now = new Date();
        let diff = Math.max(0, countdownTarget - now);
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        diff -= days * (1000 * 60 * 60 * 24);
        const hours = Math.floor(diff / (1000 * 60 * 60));
        diff -= hours * (1000 * 60 * 60);
        const minutes = Math.floor(diff / (1000 * 60));
        diff -= minutes * (1000 * 60);
        const seconds = Math.floor(diff / 1000);

        daysSpan.textContent = days.toString().padStart(2, "0");
        hoursSpan.textContent = hours.toString().padStart(2, "0");
        minutesSpan.textContent = minutes.toString().padStart(2, "0");
        secondsSpan.textContent = seconds.toString().padStart(2, "0");
      }
      setInterval(updateCountdown, 1000);
      updateCountdown();

      // Fungsi Save to Calendar
      function saveToCalendar() {
        // Data acara pernikahan
        const eventData = {
          title: "Pernikahan",
          startDate: "2025-08-10T08:00:00",
          endDate: "2025-08-10T14:00:00",
          description: "Acara pernikahan - Undangan pernikahan",
          location: "Jl. RA Fadilah, Gedung Balai Komando, Jakarta Timur",
        };

        // Format tanggal untuk berbagai platform
        const startDate = new Date(eventData.startDate);
        const endDate = new Date(eventData.endDate);

        // Format untuk Google Calendar (YYYYMMDDTHHMMSSZ)
        const formatDateForGoogle = (date) => {
          return date.toISOString().replace(/[-:]/g, "").split(".")[0] + "Z";
        };

        const googleStartDate = formatDateForGoogle(startDate);
        const googleEndDate = formatDateForGoogle(endDate);

        // Deteksi device dan buka calendar yang sesuai
        const userAgent = navigator.userAgent;

        if (/iPhone|iPad|iPod/.test(userAgent)) {
          // iOS - buka Apple Calendar
          const icsContent = [
            "BEGIN:VCALENDAR",
            "VERSION:2.0",
            "PRODID:-//Wedding Invitation//EN",
            "BEGIN:VEVENT",
            `DTSTART:${googleStartDate}`,
            `DTEND:${googleEndDate}`,
            `SUMMARY:${eventData.title}`,
            `DESCRIPTION:${eventData.description}`,
            `LOCATION:${eventData.location}`,
            "END:VEVENT",
            "END:VCALENDAR",
          ].join("\n");

          const blob = new Blob([icsContent], { type: "text/calendar" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "wedding-invitation.ics";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        } else if (/Android/.test(userAgent)) {
          // Android - buka Google Calendar
          const googleCalendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(
            eventData.title
          )}&dates=${googleStartDate}/${googleEndDate}&details=${encodeURIComponent(
            eventData.description
          )}&location=${encodeURIComponent(eventData.location)}`;
          window.open(googleCalendarUrl, "_blank");
        } else {
          // Desktop - buka Google Calendar
          const googleCalendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(
            eventData.title
          )}&dates=${googleStartDate}/${googleEndDate}&details=${encodeURIComponent(
            eventData.description
          )}&location=${encodeURIComponent(eventData.location)}`;
          window.open(googleCalendarUrl, "_blank");
        }
      }

      // Fungsi untuk mencegah viewport resize saat keyboard muncul
      function preventViewportResize() {
        const initialViewportHeight = window.innerHeight;

        // Set CSS custom property untuk height yang konsisten
        document.documentElement.style.setProperty(
          "--vh",
          `${initialViewportHeight * 0.01}px`
        );

        // Event listener untuk resize
        window.addEventListener("resize", function () {
          // Jangan update height jika perbedaan terlalu besar (kemungkinan keyboard)
          const currentHeight = window.innerHeight;
          if (Math.abs(currentHeight - initialViewportHeight) < 100) {
            document.documentElement.style.setProperty(
              "--vh",
              `${currentHeight * 0.01}px`
            );
          }
        });

        // Untuk iOS, tambahan handling
        if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
          document.addEventListener("focusin", function (e) {
            document.body.style.position = "fixed";
            document.body.style.width = "100%";
            document.body.style.height = "100%";
            document.body.style.overflow = "hidden";

            // Scroll ke atas untuk memastikan input terlihat
            window.scrollTo(0, 0);
          });

          document.addEventListener("focusout", function () {
            document.body.style.position = "";
            document.body.style.width = "";
            document.body.style.height = "";
            document.body.style.overflow = "";
          });
        }

        // Untuk Android
        if (/Android/.test(navigator.userAgent)) {
          let isKeyboardOpen = false;

          window.addEventListener("resize", function () {
            const heightDiff = initialViewportHeight - window.innerHeight;

            if (heightDiff > 150) {
              // Keyboard terbuka
              if (!isKeyboardOpen) {
                isKeyboardOpen = true;
                document.body.style.height = `${initialViewportHeight}px`;
                document.body.style.overflow = "hidden";
              }
            } else {
              // Keyboard tertutup
              if (isKeyboardOpen) {
                isKeyboardOpen = false;
                document.body.style.height = "";
                document.body.style.overflow = "";
              }
            }
          });
        }
      }

      // Panggil fungsi saat halaman dimuat
      preventViewportResize();

      // Fungsi untuk mengontrol musik background
      function toggleBackgroundMusic() {
        const musicIcon = document.getElementById("music-icon");
        const musicControl = document.getElementById("music-control");

        if (backgroundMusic.paused) {
          backgroundMusic.play().catch((error) => {
            console.log("Error playing music:", error);
          });
          musicIcon.textContent = "üîä";
          musicControl.style.background = "rgba(0, 0, 0, 0.5)";
        } else {
          backgroundMusic.pause();
          musicIcon.textContent = "üîá";
          musicControl.style.background = "rgba(255, 0, 0, 0.5)";
        }
      }

      // Update icon musik saat musik dimulai dari frame-1
      function updateMusicIcon() {
        const musicIcon = document.getElementById("music-icon");
        const musicControl = document.getElementById("music-control");

        if (!backgroundMusic.paused) {
          musicIcon.textContent = "üîä";
          musicControl.style.background = "rgba(0, 0, 0, 0.5)";
        }
      }

      // Pastikan musik tetap berjalan saat navigasi antar frame
      function ensureMusicPlaying() {
        if (backgroundMusic.paused && currentSection > 0) {
          backgroundMusic.play().catch((error) => {
            console.log("Error resuming music:", error);
          });
        }
      }

      // Update goToSection untuk memastikan musik tetap berjalan
      const originalGoToSection = goToSection;
      goToSection = function (idx) {
        originalGoToSection(idx);
        // Pastikan musik tetap berjalan setelah navigasi
        setTimeout(() => {
          ensureMusicPlaying();
        }, 100);
      };
    </script>
    <script>
      // GANTI URL DI BAWAH INI DENGAN URL ENDPOINT ANDA DARI SHEETY
      const sheetyURL =
        "https://api.sheety.co/e97cba70fbd5876af01e762485b8bdf8/weddingConfirmation/sheet1"; // << GANTI INI

      // --- FUNGSI BARU UNTUK MENGAMBIL DATA DARI SHEET (GET) ---
      async function loadHopesFromSheet() {
        const hopesListElement = document.getElementById("hopes-list");
        hopesListElement.innerHTML = `<p style="color: #9a2828; font-size: 10px; text-align: center;">Memuat harapan...</p>`;

        try {
          const response = await fetch(sheetyURL);
          if (!response.ok) {
            throw new Error(`Gagal memuat data: ${response.status}`);
          }
          const data = await response.json();

          // 'sheet1' harus sesuai dengan nama sheet Anda di Sheety
          const hopes = data.sheet1 || [];

          // Panggil fungsi untuk menampilkan data
          updateDisplay(hopes);
        } catch (error) {
          console.error("Error mengambil data dari Sheety:", error);
          hopesListElement.innerHTML = `<p style="color: #9a2828; font-size: 10px; text-align: center;">Gagal memuat harapan.</p>`;
        }
      }

      // --- FUNGSI YANG DIMODIFIKASI UNTUK MENAMPILKAN DATA ---
      function updateDisplay(hopesData = []) {
        const counterElement = document.getElementById("counter-number");
        const hopesListElement = document.getElementById("hopes-list");

        if (counterElement) {
          counterElement.textContent = hopesData.length;
        }

        if (hopesListElement) {
          if (hopesData.length === 0) {
            hopesListElement.innerHTML = `
            <p style="color: #9a2828; font-size: 10px; text-align: center; font-style: italic;">Belum ada harapan yang ditulis</p>
          `;
            return;
          }

          // Ambil 50 data terakhir dan balik urutannya agar yang terbaru di atas
          const displayData = hopesData.slice(-50).reverse();

          hopesListElement.innerHTML = displayData
            .map(
              (hope) => `
          <div style="background: rgba(154, 40, 40, 0.1); border-radius: 5px; padding: 8px; margin-bottom: 8px; border-left: 3px solid rgba(154, 40, 40, 0.5);">
            <p style="color: #9a2828; font-size: 9px; font-weight: bold; margin: 0 0 3px 0;">${
              hope.nama || "Anonim"
            }</p>
            <p style="color: #b73838; font-size: 8px; line-height: 1.3; margin: 0;">${
              hope.harapan || ""
            }</p>
          </div>
        `
            )
            .join("");
        }
      }

      // --- FUNGSI PENGIRIMAN DATA (POST) YANG SUDAH ADA ---
      async function submitData() {
        const nameInput = document.getElementById("frame16-input");
        const hopeInput = document.getElementById("frame16-input-2");
        const attendanceRadio = document.querySelector(
          'input[name="kehadiran"]:checked'
        );
        const submitBtn = document.getElementById("submit-btn");

        if (
          !nameInput.value.trim() ||
          !hopeInput.value.trim() ||
          !attendanceRadio
        ) {
          alert(
            "Mohon lengkapi semua isian: Nama, Harapan, dan Konfirmasi Kehadiran."
          );
          return;
        }

        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = "‚è≥ Mengirim...";
        submitBtn.disabled = true;

        // 'sheet1' harus sama dengan nama tab di Google Sheet Anda
        let dataToSend = {
          sheet1: {
            nama: nameInput.value.trim(),
            harapan: hopeInput.value.trim(),
            konfirmasi: attendanceRadio.value,
            tanggal: new Date().toLocaleString("id-ID"),
          },
        };

        try {
          const response = await fetch(sheetyURL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(dataToSend),
          });

          if (!response.ok)
            throw new Error(`HTTP error! status: ${response.status}`);

          submitBtn.innerHTML = "‚úÖ Terkirim!";
          submitBtn.style.background =
            "linear-gradient(135deg, #22c55e, #16a34a)";

          nameInput.value = "";
          hopeInput.value = "";
          attendanceRadio.checked = false;

          // **PENTING: Muat ulang data harapan setelah berhasil mengirim**
          await loadHopesFromSheet();
        } catch (error) {
          console.error("Error mengirim data ke Sheety:", error);
          submitBtn.innerHTML = "‚ùå Gagal! Coba Lagi";
          submitBtn.style.background =
            "linear-gradient(135deg, #dc2626, #b91c1c)";
        }

        setTimeout(() => {
          submitBtn.innerHTML = originalText;
          submitBtn.style.background =
            "linear-gradient(135deg, #9a2828, #c53030)";
          submitBtn.disabled = false;
        }, 3000);
      }

      // --- MEMANGGIL FUNGSI SAAT HALAMAN SELESAI DIMUAT ---
      document.addEventListener("DOMContentLoaded", function () {
        loadHopesFromSheet(); // Memuat data dari Sheet saat pertama kali halaman dibuka
      });
    </script>
  </body>
</html>
